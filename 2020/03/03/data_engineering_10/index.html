<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">

    

    
    <title>data engineering (데이터 모델링 및 챗봇 만들기) | DataLatte&#39;s IT Blog</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content>
    
    
    <meta name="description" content="Spotify 데이터 유사도 모델링 모든 track을 다 유클리디안 거리를 계산해서 유사도를 측정하기에는 많은 양이기 때문에 해당 Artist의 track들의 audio feature 데이터에 대해 평균을 낸 값을 사용하여 Artist 끼리의 유사도를 계산할 것이다. 해당 유사도를 계산하기 위해 아래와 같이 먼저 RDS에 접속하여 table을 생성해 준다.">
<meta property="og:type" content="article">
<meta property="og:title" content="data engineering (데이터 모델링 및 챗봇 만들기)">
<meta property="og:url" content="https://heung-bae-lee.github.io/2020/03/03/data_engineering_10/index.html">
<meta property="og:site_name" content="DataLatte&#39;s IT Blog">
<meta property="og:description" content="Spotify 데이터 유사도 모델링 모든 track을 다 유클리디안 거리를 계산해서 유사도를 측정하기에는 많은 양이기 때문에 해당 Artist의 track들의 audio feature 데이터에 대해 평균을 낸 값을 사용하여 Artist 끼리의 유사도를 계산할 것이다. 해당 유사도를 계산하기 위해 아래와 같이 먼저 RDS에 접속하여 table을 생성해 준다.">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://heung-bae-lee.github.io/image/Athena_similarity_table_create.png">
<meta property="og:updated_time" content="2020-03-05T14:57:56.289Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="data engineering (데이터 모델링 및 챗봇 만들기)">
<meta name="twitter:description" content="Spotify 데이터 유사도 모델링 모든 track을 다 유클리디안 거리를 계산해서 유사도를 측정하기에는 많은 양이기 때문에 해당 Artist의 track들의 audio feature 데이터에 대해 평균을 낸 값을 사용하여 Artist 끼리의 유사도를 계산할 것이다. 해당 유사도를 계산하기 위해 아래와 같이 먼저 RDS에 접속하여 table을 생성해 준다.">
<meta name="twitter:image" content="https://heung-bae-lee.github.io/image/Athena_similarity_table_create.png">
<meta property="fb:app_id" content="100003222637819">


    <link rel="canonical" href="https://heung-bae-lee.github.io/2020/03/03/data_engineering_10/">

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-154199624-1', 'auto');
ga('send', 'pageview');

</script>

    
    


    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 상단형 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4604833066889492" data-ad-slot="4588503508" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<link rel="alternate" href="/rss2.xml" title="DataLatte's IT Blog" type="application/rss+xml">
</head>
</html>
<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">DataLatte&#39;s IT Blog using Hexo</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Bayes/">Bayes</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/C-C-자료구조/">C/C++/자료구조</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/CS231n/">CS231n</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Front-end/">Front end</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Kaggle/">Kaggle</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/NLP/">NLP</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Recommendation-System/">Recommendation System</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Statistics-Mathematical-Statistics/">Statistics - Mathematical Statistics</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/crawling/">crawling</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/data-engineering/">data engineering</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/deep-learning/">deep learning</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/growth-hacking/">growth hacking</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/hexo/">hexo</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/linear-algebra/">linear algebra</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/machine-learning/">machine learning</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/data-engineering/">data engineering</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 상단형 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4604833066889492"
     data-ad-slot="4588503508"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

			    <article id="post-data_engineering_10" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        data engineering (데이터 모델링 및 챗봇 만들기)
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2020/03/03/data_engineering_10/" class="article-date">
            <time datetime="2020-03-03T14:29:20.000Z" itemprop="datePublished">2020-03-03</time>
        </a>
    </div>

		

                
            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <h1 id="Spotify-데이터-유사도-모델링"><a href="#Spotify-데이터-유사도-모델링" class="headerlink" title="Spotify 데이터 유사도 모델링"></a>Spotify 데이터 유사도 모델링</h1><ul>
<li>모든 track을 다 유클리디안 거리를 계산해서 유사도를 측정하기에는 많은 양이기 때문에 해당 Artist의 track들의 audio feature 데이터에 대해 평균을 낸 값을 사용하여 Artist 끼리의 유사도를 계산할 것이다. 해당 유사도를 계산하기 위해 아래와 같이 먼저 RDS에 접속하여 table을 생성해 준다.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -h spotify.cgaj5rvtgf25.ap-northeast-2.rds.amazonaws.com -P 3306 -u hb0619 -p</span><br><span class="line"></span><br><span class="line">CREATE TABLE related_artists (artist_id VARCHAR(255), y_artist VARCHAR(255), distance FLOAT, PRIMARY KEY(artist_id, y_artist)) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<ul>
<li>그 다음은 우리가 미리 만들어놓았던 Athena의 DataBase는 무엇이었는지를 확인하자. 필자는 아래와 같이 따로 Database를 만들지 않고 default로 사용했다. 또한, 입력했었던 날짜를 확인해놓아야 추후에 코드 작성시 Athena로 접속하여 만들어진 테이블들을 참조할 수 있다.</li>
</ul>
<p><img src="/image/Athena_similarity_table_create.png" alt="Athena database"></p>
<ul>
<li><p>필자는 Athena에 미리 만들어놓았던 두가지 top_tracks와 audio_features 테이블을 이용하여 유사도를 구하고 해당 유사도를 MySQL DB에 insert하는 방식으로 작업을 진행 할 것이다.</p>
</li>
<li><p>data_modeling.py</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">import logging</span><br><span class="line">import pymysql</span><br><span class="line">import boto3</span><br><span class="line">import time</span><br><span class="line">import math</span><br><span class="line"></span><br><span class="line">host = <span class="string">"end-point url"</span></span><br><span class="line">port = you port number</span><br><span class="line">username = <span class="string">"your MYSQL DB ID"</span></span><br><span class="line">database = <span class="string">"your MYSQL DB Name"</span></span><br><span class="line">password = <span class="string">"your MYSQL DB Password"</span></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        conn = pymysql.connect(host, user=username, passwd=password, db=database, port=port, use_unicode=True, charset=<span class="string">'utf8'</span>)</span><br><span class="line">        cursor = conn.cursor()</span><br><span class="line">    except:</span><br><span class="line">        logging.error(<span class="string">"could not connect to rds"</span>)</span><br><span class="line">        sys.exit(1)</span><br><span class="line"></span><br><span class="line">    athena = boto3.client(<span class="string">'athena'</span>)</span><br><span class="line"></span><br><span class="line">    query = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        SELECT</span></span><br><span class="line"><span class="string">         artist_id,</span></span><br><span class="line"><span class="string">         AVG(danceability) AS danceability,</span></span><br><span class="line"><span class="string">         AVG(energy) AS energy,</span></span><br><span class="line"><span class="string">         AVG(loudness) AS loudness,</span></span><br><span class="line"><span class="string">         AVG(speechiness) AS speechiness,</span></span><br><span class="line"><span class="string">         AVG(acousticness) AS acousticness,</span></span><br><span class="line"><span class="string">         AVG(instrumentalness) AS instrumentalness</span></span><br><span class="line"><span class="string">        FROM</span></span><br><span class="line"><span class="string">         top_tracks t1</span></span><br><span class="line"><span class="string">        JOIN</span></span><br><span class="line"><span class="string">         audio_features t2 ON t2.id = t1.id AND CAST(t1.dt AS DATE) = DATE('2020-02-24') AND CAST(t2.dt AS DATE) = DATE('2020-02-24')</span></span><br><span class="line"><span class="string">        GROUP BY t1.artist_id</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    <span class="comment"># 위에서 DATE를 정하는 부분에서 CAST(t1.dt AS DATE) = CURRENT_DATE - INTERVAL '1' DAY 이렇게 현재날짜를 기준으로 차이나는 기간을 통해 정해줄 수 있다.</span></span><br><span class="line">    <span class="comment"># 필자는 여러번 Athena에 실행하지 않았기 때문에 최근에 Athena에 만들어 놓은 위의 두 테이블의 데이터를 직접 보고 날짜를 지정했다.</span></span><br><span class="line"></span><br><span class="line">    r = query_athena(query, athena)</span><br><span class="line">    results = get_query_result(r[<span class="string">'QueryExecutionId'</span>], athena)</span><br><span class="line">    artists = process_data(results)</span><br><span class="line"></span><br><span class="line">    query = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        SELECT</span></span><br><span class="line"><span class="string">         MIN(danceability) AS danceability_min,</span></span><br><span class="line"><span class="string">         MAX(danceability) AS danceability_max,</span></span><br><span class="line"><span class="string">         MIN(energy) AS energy_min,</span></span><br><span class="line"><span class="string">         MAX(energy) AS energy_max,</span></span><br><span class="line"><span class="string">         MIN(loudness) AS loudness_min,</span></span><br><span class="line"><span class="string">         MAX(loudness) AS loudness_max,</span></span><br><span class="line"><span class="string">         MIN(speechiness) AS speechiness_min,</span></span><br><span class="line"><span class="string">         MAX(speechiness) AS speechiness_max,</span></span><br><span class="line"><span class="string">         ROUND(MIN(acousticness),4) AS acousticness_min,</span></span><br><span class="line"><span class="string">         MAX(acousticness) AS acousticness_max,</span></span><br><span class="line"><span class="string">         MIN(instrumentalness) AS instrumentalness_min,</span></span><br><span class="line"><span class="string">         MAX(instrumentalness) AS instrumentalness_max</span></span><br><span class="line"><span class="string">        FROM</span></span><br><span class="line"><span class="string">         audio_features</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    r = query_athena(query, athena)</span><br><span class="line">    results = get_query_result(r[<span class="string">'QueryExecutionId'</span>], athena)</span><br><span class="line">    avgs = process_data(results)[0]</span><br><span class="line"></span><br><span class="line">    metrics = [<span class="string">'danceability'</span>, <span class="string">'energy'</span>, <span class="string">'loudness'</span>, <span class="string">'speechiness'</span>, <span class="string">'acousticness'</span>, <span class="string">'instrumentalness'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> artists:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> artists:</span><br><span class="line">            dist = 0</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> metrics:</span><br><span class="line">                x = <span class="built_in">float</span>(i[k])</span><br><span class="line">                x_norm = normalize(x, <span class="built_in">float</span>(avgs[k+<span class="string">'_min'</span>]), <span class="built_in">float</span>(avgs[k+<span class="string">'_max'</span>]))</span><br><span class="line">                y = <span class="built_in">float</span>(j[k])</span><br><span class="line">                y_norm = normalize(y, <span class="built_in">float</span>(avgs[k+<span class="string">'_min'</span>]), <span class="built_in">float</span>(avgs[k+<span class="string">'_max'</span>]))</span><br><span class="line">                dist += (x_norm-y_norm)**2</span><br><span class="line"></span><br><span class="line">            dist = math.sqrt(dist) <span class="comment">## euclidean distance</span></span><br><span class="line"></span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">'artist_id'</span>: i[<span class="string">'artist_id'</span>],</span><br><span class="line">                <span class="string">'y_artist'</span>: j[<span class="string">'artist_id'</span>],</span><br><span class="line">                <span class="string">'distance'</span>: dist</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            insert_row(cursor, data, <span class="string">'related_artists'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    conn.commit()</span><br><span class="line">    cursor.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def normalize(x, x_min, x_max):</span><br><span class="line"></span><br><span class="line">    normalized = (x-x_min) / (x_max-x_min)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> normalized</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def query_athena(query, athena):</span><br><span class="line">    response = athena.start_query_execution(</span><br><span class="line">        QueryString=query,</span><br><span class="line">        QueryExecutionContext=&#123;</span><br><span class="line">            <span class="string">'Database'</span>: <span class="string">'default'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        ResultConfiguration=&#123;</span><br><span class="line">            <span class="string">'OutputLocation'</span>: <span class="string">"s3://spotify-chatbot-project/athena-panomix-tables/"</span>,</span><br><span class="line">            <span class="string">'EncryptionConfiguration'</span>: &#123;</span><br><span class="line">                <span class="string">'EncryptionOption'</span>: <span class="string">'SSE_S3'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="comment"># 아래와 같이 Athena API는 response를 받았다고 해서 결과를 보여주는 것이 아니라 실행을 시킨 후에</span></span><br><span class="line"><span class="comment"># 해당 query id를 통해 결과를 가져오는 형식으로 이루어져 있다.</span></span><br><span class="line">def get_query_result(query_id, athena):</span><br><span class="line"></span><br><span class="line">    response = athena.get_query_execution(</span><br><span class="line">        QueryExecutionId=str(query_id)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">while</span> response[<span class="string">'QueryExecution'</span>][<span class="string">'Status'</span>][<span class="string">'State'</span>] != <span class="string">'SUCCEEDED'</span>:</span><br><span class="line">        <span class="keyword">if</span> response[<span class="string">'QueryExecution'</span>][<span class="string">'Status'</span>][<span class="string">'State'</span>] == <span class="string">'FAILED'</span>:</span><br><span class="line">            logging.error(<span class="string">'QUERY FAILED'</span>)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">        time.sleep(5)</span><br><span class="line">        response = athena.get_query_execution(</span><br><span class="line">            QueryExecutionId=str(query_id)</span><br><span class="line">        )</span><br><span class="line">    <span class="comment"># 중요한 점은 MaxResults가 1000이 Max라는 점이다.</span></span><br><span class="line">    response = athena.get_query_results(</span><br><span class="line">        QueryExecutionId=str(query_id)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def process_data(results):</span><br><span class="line"></span><br><span class="line">    columns = [col[<span class="string">'Label'</span>] <span class="keyword">for</span> col <span class="keyword">in</span> results[<span class="string">'ResultSet'</span>][<span class="string">'ResultSetMetadata'</span>][<span class="string">'ColumnInfo'</span>]]</span><br><span class="line"></span><br><span class="line">    listed_results = []</span><br><span class="line">    <span class="keyword">for</span> res <span class="keyword">in</span> results[<span class="string">'ResultSet'</span>][<span class="string">'Rows'</span>][1:]:</span><br><span class="line">        values = []</span><br><span class="line">        <span class="keyword">for</span> field <span class="keyword">in</span> res[<span class="string">'Data'</span>]:</span><br><span class="line">            try:</span><br><span class="line">                values.append(list(field.values())[0])</span><br><span class="line">            except:</span><br><span class="line">                values.append(list(<span class="string">' '</span>))</span><br><span class="line">        listed_results.append(dict(zip(columns, values)))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> listed_results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def insert_row(cursor, data, table):</span><br><span class="line"></span><br><span class="line">    placeholders = <span class="string">', '</span>.join([<span class="string">'%s'</span>] * len(data))</span><br><span class="line">    columns = <span class="string">', '</span>.join(data.keys())</span><br><span class="line">    key_placeholders = <span class="string">', '</span>.join([<span class="string">'&#123;0&#125;=%s'</span>.format(k) <span class="keyword">for</span> k <span class="keyword">in</span> data.keys()])</span><br><span class="line">    sql = <span class="string">"INSERT INTO %s ( %s ) VALUES ( %s ) ON DUPLICATE KEY UPDATE %s"</span> % (table, columns, placeholders, key_placeholders)</span><br><span class="line">    cursor.execute(sql, list(data.values())*2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<ul>
<li>위의 파일을 실행시켜보자. 위의 python script 파일이 존재하는 path로 이동하여 아래 명령문을 실행시키면 실행에 완료될때까지 걸린 시간 또한 알 수 있다.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">time python3 data_modeling.py</span><br><span class="line"></span><br><span class="line">real	28m11.013s</span><br><span class="line">user	1m36.141s</span><br><span class="line">sys	0m24.518s</span><br></pre></td></tr></table></figure>
<ul>
<li>이제 MySQL에 접속해서 데이터가 제대로 insert 됬는지 확인해 보자.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM related_artists LIMIT 20;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 결과</span></span><br><span class="line">+------------------------+------------------------+-----------+</span><br><span class="line">| artist_id              | y_artist               | distance  |</span><br><span class="line">+------------------------+------------------------+-----------+</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 00FQb4jTyendYWaN8pK0wa |         0 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 01C9OoXDvCKkGcf735Tcfo |  0.366558 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 02rd0anEWfMtF7iMku9uor |  0.327869 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 02uYdhMhCgdB49hZlYRm9o |  0.595705 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 03r4iKL2g2442PT9n2UKsx |  0.632109 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 03YhcM6fxypfwckPCQV8pQ |  0.812604 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 04gDigrS5kc9YWfZHwBETP |  0.498764 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 04tBaW21jyUfeP5iqiKBVq |  0.322017 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 0543y7yrvny4KymoaneT4W |  0.365608 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 05E3NBxNMdnrPtxF9oraJm |  0.958604 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 06HL4z0CvFAxyc27GXpf02 |  0.483454 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 06nevPmNVfWUXyZkccahL8 | 0.0592581 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 06nsZ3qSOYZ2hPVIMcr1IN |   0.39567 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 085pc2PYOi8bGKj0PNjekA |  0.608243 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 08avsqaGIlK2x3i2Cu7rKH |  0.328059 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 09C0xjtosNAIXP36wTnWxd |  0.210568 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 0BvkDsjIUla7X0k6CSWh1I |  0.606556 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 0bvRYuXRvd14RYEE7c0PRW |  0.670187 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 0C0XlULifJtAgn6ZNCW2eu |   0.70478 |</span><br><span class="line">| 00FQb4jTyendYWaN8pK0wa | 0cc6vw3VN8YlIcvr1v7tBL |  0.716507 |</span><br><span class="line">+------------------------+------------------------+-----------+</span><br><span class="line">20 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>JOIN을 통해 각각 이름을 볼수있게 해주면서 가장 distance가 작은 즉 유사성이 큰 데이터 순서로 보여주길 원해 아래와 같은 query를 작성하여 실행시켰다. 그 결과, audio_features로만 모델링을 했음에도 비슷한 장르의 아티스트가 묶여있음을 확인할 수 있다.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SELECT p1.name, p2.name, p1.url, p2.url, p2.distance FROM artists p1 JOIN (SELECT t1.name, t1.url, t2.y_artist, t2.distance FROM artists t1 JOIN related_artists t2 ON t2.artist_id = t1.id) p2 ON p2.y_artist=p1.id WHERE distance != 0 ORDER BY p2.distance ASC LIMIT 20;</span><br><span class="line"></span><br><span class="line">+-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------------------+-----------+</span><br><span class="line">| name                          | name                          | url                                                    | url                                                    | distance  |</span><br><span class="line">+-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------------------+-----------+</span><br><span class="line">| Four Tops                     | Alan Jackson                  | https://open.spotify.com/artist/7fIvjotigTGWqjIz6EP1i4 | https://open.spotify.com/artist/4mxWe1mtYIYfP040G38yvS | 0.0241995 |</span><br><span class="line">| Alan Jackson                  | Four Tops                     | https://open.spotify.com/artist/4mxWe1mtYIYfP040G38yvS | https://open.spotify.com/artist/7fIvjotigTGWqjIz6EP1i4 | 0.0241995 |</span><br><span class="line">| Martha Reeves &amp; The Vandellas | Jimmy Ruffin                  | https://open.spotify.com/artist/1Pe5hlKMCTULjosqZ6KanP | https://open.spotify.com/artist/0hF0PwB04hnXfYMiZWfJzy | 0.0258624 |</span><br><span class="line">| Jimmy Ruffin                  | Martha Reeves &amp; The Vandellas | https://open.spotify.com/artist/0hF0PwB04hnXfYMiZWfJzy | https://open.spotify.com/artist/1Pe5hlKMCTULjosqZ6KanP | 0.0258624 |</span><br><span class="line">| George Harrison               | Martha Reeves &amp; The Vandellas | https://open.spotify.com/artist/7FIoB5PHdrMZVC3q2HE5MS | https://open.spotify.com/artist/1Pe5hlKMCTULjosqZ6KanP | 0.0272287 |</span><br><span class="line">| Martha Reeves &amp; The Vandellas | George Harrison               | https://open.spotify.com/artist/1Pe5hlKMCTULjosqZ6KanP | https://open.spotify.com/artist/7FIoB5PHdrMZVC3q2HE5MS | 0.0272287 |</span><br><span class="line">| Nik Kershaw                   | Elton John                    | https://open.spotify.com/artist/7kCL98rPFsNKjAHDmWrMac | https://open.spotify.com/artist/3PhoLpVuITZKcymswpck5b | 0.0272474 |</span><br><span class="line">| Elton John                    | Nik Kershaw                   | https://open.spotify.com/artist/3PhoLpVuITZKcymswpck5b | https://open.spotify.com/artist/7kCL98rPFsNKjAHDmWrMac | 0.0272474 |</span><br><span class="line">| Tammi Terrell                 | Kim Carnes                    | https://open.spotify.com/artist/75jNCko3SnEMI5gwGqrbb8 | https://open.spotify.com/artist/5PN2aHIvLEM98XIorsPMhE | 0.0279891 |</span><br><span class="line">| Kim Carnes                    | Tammi Terrell                 | https://open.spotify.com/artist/5PN2aHIvLEM98XIorsPMhE | https://open.spotify.com/artist/75jNCko3SnEMI5gwGqrbb8 | 0.0279891 |</span><br><span class="line">| Roger Daltrey                 | Arcade Fire                   | https://open.spotify.com/artist/5odf7hjI7hyvAw66tmxhGF | https://open.spotify.com/artist/3kjuyTCjPG1WMFCiyc5IuB | 0.0291541 |</span><br><span class="line">| Arcade Fire                   | Roger Daltrey                 | https://open.spotify.com/artist/3kjuyTCjPG1WMFCiyc5IuB | https://open.spotify.com/artist/5odf7hjI7hyvAw66tmxhGF | 0.0291541 |</span><br><span class="line">| Billy Fury                    | Otis Redding                  | https://open.spotify.com/artist/7rtLZcKWGV4eaZsBwSKimf | https://open.spotify.com/artist/60df5JBRRPcnSpsIMxxwQm | 0.0292248 |</span><br><span class="line">| Otis Redding                  | Billy Fury                    | https://open.spotify.com/artist/60df5JBRRPcnSpsIMxxwQm | https://open.spotify.com/artist/7rtLZcKWGV4eaZsBwSKimf | 0.0292248 |</span><br><span class="line">| Katy Perry                    | John Fogerty                  | https://open.spotify.com/artist/6jJ0s89eD6GaHleKKya26X | https://open.spotify.com/artist/5ujCegv1BRbEPTCwQqFk6t | 0.0302168 |</span><br><span class="line">| John Fogerty                  | Katy Perry                    | https://open.spotify.com/artist/5ujCegv1BRbEPTCwQqFk6t | https://open.spotify.com/artist/6jJ0s89eD6GaHleKKya26X | 0.0302168 |</span><br><span class="line">| Dierks Bentley                | The Cadillac Three            | https://open.spotify.com/artist/7x8nK0m0cP2ksQf0mjWdPS | https://open.spotify.com/artist/1nivFfWu6oXBFDNyVfFU5x | 0.0313435 |</span><br><span class="line">| The Cadillac Three            | Dierks Bentley                | https://open.spotify.com/artist/1nivFfWu6oXBFDNyVfFU5x | https://open.spotify.com/artist/7x8nK0m0cP2ksQf0mjWdPS | 0.0313435 |</span><br><span class="line">| Sheryl Crow                   | Phil Collins                  | https://open.spotify.com/artist/4TKTii6gnOnUXQHyuo9JaD | https://open.spotify.com/artist/4lxfqrEsLX6N1N4OCSkILp | 0.0317203 |</span><br><span class="line">| Phil Collins                  | Sheryl Crow                   | https://open.spotify.com/artist/4lxfqrEsLX6N1N4OCSkILp | https://open.spotify.com/artist/4TKTii6gnOnUXQHyuo9JaD | 0.0317203 |</span><br><span class="line">+-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------------------+-----------+</span><br><span class="line">20 rows <span class="keyword">in</span> <span class="built_in">set</span> (1.18 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>이제 Facebook messenger API를 통해 챗봇을 서비스를 만들어 볼 것이다. 아래 그림과 같이 구글에서 Facebook messenger API를 검색하여 페이지로 접속한다.</li>
</ul>
<p><img src="/image/search_Facebook_messenger_API.png" alt="Facebook messenger API 검색"></p>
<ul>
<li>Facebook messenger API 웹페이지를 접속하면 아래 그림처럼 보이며, 그에 대한 작동원리에 대한 설명은 Introduction의 learn more를 클릭하면 두번째 그림과 같이 작동원리를 보여준다. 간단히 말하자면, User가 Facebook messenger API를 통해 질의하면 그 정보를 Business Server에 보내서 해당 질문에 따른 답변을 가져와 보여주는 형식이다.</li>
</ul>
<p><img src="/image/introduction_click_facebook_messenger_api.png" alt="Facebook messenger API 웹페이지"></p>
<p><img src="/image/Facebook_messenger_plattform_principal.png" alt="Facebook messenger API 작동방식"></p>
<ul>
<li>Facebook messenger API를 통해서는 다양한 방식의 답변을 제공할 수 있다. 이미 만들어져있는 UI/UX 템플릿들이 존재하기 때문에 원하는 형식에 맞춰 다양하게 서비스를 제공할 수 있다.</li>
</ul>
<p><img src="/image/Quick_answer_Facebook_messenger_api.png" alt="FaceBook messenger API의 Quick Answer"></p>
<p><img src="/image/Facebook_API_Messenge_template.png" alt="Facebook messenger의 message 템플릿"></p>
<ul>
<li><code>Facebook messenger API를 사용하기 위해서는 가장 먼저 페이지가 만들어져 있어야 한다.</code> 아래와 같이 새로운 페이지를 만들거나 이미 만들어져 있는 자신의 페이지를 먼저 등록시킨다.</li>
</ul>
<p><img src="/image/create_page_facebook_messenger_api_01.png" alt="페이지 생성 - 01"></p>
<p><img src="/image/create_page_facebook_messenger_api_02.png" alt="페이지 생성 - 02"></p>
<p><img src="/image/create_page_facebook_messenger_api_03.png" alt="페이지 생성 - 03"></p>
<p><img src="/image/create_page_facebook_messenger_api_04.png" alt="페이지 생성 - 04"></p>
<p><img src="/image/create_page_facebook_messenger_api_05.png" alt="페이지 생성 - 05"></p>
<ul>
<li>Lambda를 통해서 AWS와 Facebook messenger API를 연결해 볼 것이다. Lambda를 사용하는 이유는 지난번에 언급했던 것과 같이 EC2와 같이 서버를 항상 띄어놓고 정해진 resource를 통해 서비스를 관리하면 늘어나거나 줄어드는 User에 대해서 유연하게 처리하기 힘들기 때문이다. Lambda는 예를 들어 기하급수적으로 User가 늘더라도 그에따라 병렬적으로 작업하기 때문에 Traffic의 크기에 크게 영향을 받지 않는다. 반대로 EC2의 경우에는 해당 Traffic이 증가함에 따라 여러가지 장치를 구현해 놓아야한다. AWS에 로그인한 후 Lambda를 들어가서, 아래 그림과 같이 새로운 Lambda Function을 생성해 준다.</li>
</ul>
<p><img src="/image/new_create_lambda_function_aws_01.png" alt="Facebook messenger API를 사용하기 위한 Lambda Function 생성 - 01"></p>
<p><img src="/image/new_create_lambda_function_aws_02.png" alt="Facebook messenger API를 사용하기 위한 Lambda Function 생성 - 02"></p>
<p><img src="/image/new_create_lambda_function_aws_03.png" alt="Facebook messenger API를 사용하기 위한 Lambda Function 생성 - 03"></p>
<p><img src="/image/new_create_lambda_function_aws_04.png" alt="Facebook messenger API를 사용하기 위한 Lambda Function 생성 - 04"></p>
<ul>
<li>이제 위에서 만든 Lambda Function과 Facebook messenger API를 연결하기 위해서 AWS에서 API 관리 및 설정을 담당하는 API Gateway 페이지로 이동해서 새롭게 API Gate를 만들 것이다.</li>
</ul>
<p><img src="/image/AWS_api_gate_service.png" alt="AWS API Gateway service"></p>
<p><img src="/image/Amazon_API_Gateway.png" alt="AWS API Gateway 생성 - 01"></p>
<ul>
<li>필자는 REST API 방식으로 생성할 것이기 때문에 아래와 같이 설정하였으며, API이름도 설정해 주었다.</li>
</ul>
<p><img src="/image/Amazon_API_Gateway_creation_01.png" alt="AWS API Gateway 생성 - 02"></p>
<ul>
<li>그 다음은 Crawling할 때 한번씩 접해봤을 법한 GET, POST Method를 만들어 주는 과정을 거친다. 먼저 GET은 Integration type을 Lambda Function으로 설정해 주고, Lambda Function은 방금 만들어놓은 것을 사용할 것이다. 이렇게 설정한 뒤에 Integration Request 탭으로 이동하여 Mapping Templates의 Request body passthrough 아래와같이 설정하며, <code>mapping Templates에 application/json을 추가</code>해준다. Generate template을 Method Request passthrough로 설정한 후 최종적으로 save를 하여 GET method의 설정을 마친다. 필자가 사용할 서비스에서는 POST method는 Facebook API에 데이터를 주는 역할 밖에 없기 때문에 크게 설정할 것이 없다.</li>
</ul>
<p><img src="/image/Amazon_API_Gateway_creation_02.png" alt="AWS API Gateway 생성 - 03"></p>
<p><img src="/image/Amazon_API_Gateway_creation_03.png" alt="AWS API Gateway 생성 - 04"></p>
<p><img src="/image/Amazon_API_Gateway_creation_04.png" alt="AWS API Gateway 생성 - 05"></p>
<p><img src="/image/Amazon_API_Gateway_creation_05.png" alt="AWS API Gateway 생성 - 06"></p>
<p><img src="/image/Amazon_API_Gateway_creation_06.png" alt="AWS API Gateway 생성 - 07"></p>
<p><img src="/image/Amazon_API_Gateway_creation_07.png" alt="AWS API Gateway 생성 - 08"></p>
<p><img src="/image/Amazon_API_Gateway_creation_08.png" alt="AWS API Gateway 생성 - 09"></p>

        </div>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 하단형 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4604833066889492"
     data-ad-slot="9861011486"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        <footer class="article-footer">
            


    <div class="a2a_kit a2a_default_style">
    <a class="a2a_dd" href="https://www.addtoany.com/share">Share</a>
    <span class="a2a_divider"></span>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_google_plus"></a>
    <a class="a2a_button_pinterest"></a>
    <a class="a2a_button_tumblr"></a>
</div>
<script type="text/javascript" src="//static.addtoany.com/menu/page.js"></script>
<style>
    .a2a_menu {
        border-radius: 4px;
    }
    .a2a_menu a {
        margin: 2px 0;
        font-size: 14px;
        line-height: 16px;
        border-radius: 4px;
        color: inherit !important;
        font-family: 'Microsoft Yahei';
    }
    #a2apage_dropdown {
        margin: 10px 0;
    }
    .a2a_mini_services {
        padding: 10px;
    }
    a.a2a_i,
    i.a2a_i {
        width: 122px;
        line-height: 16px;
    }
    a.a2a_i .a2a_svg,
    a.a2a_more .a2a_svg {
        width: 16px;
        height: 16px;
        line-height: 16px;
        vertical-align: top;
        background-size: 16px;
    }
    a.a2a_i {
        border: none !important;
    }
    a.a2a_menu_show_more_less {
        margin: 0;
        padding: 10px 0;
        line-height: 16px;
    }
    .a2a_mini_services:after{content:".";display:block;height:0;clear:both;visibility:hidden}
    .a2a_mini_services{*+height:1%;}
</style>


        </footer>
    </div>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "HeungBae Lee"
        },
        "headline": "data engineering (데이터 모델링 및 챗봇 만들기)",
        "image": "https://heung-bae-lee.github.io/image/Athena_similarity_table_create.png",
        "keywords": "",
        "genre": "data engineering",
        "datePublished": "2020-03-03",
        "dateCreated": "2020-03-03",
        "dateModified": "2020-03-05",
        "url": "https://heung-bae-lee.github.io/2020/03/03/data_engineering_10/",
        "description": "Spotify 데이터 유사도 모델링
모든 track을 다 유클리디안 거리를 계산해서 유사도를 측정하기에는 많은 양이기 때문에 해당 Artist의 track들의 audio feature 데이터에 대해 평균을 낸 값을 사용하여 Artist 끼리의 유사도를 계산할 것이다. 해당 유사도를 계산하기 위해 아래와 같이 먼저 RDS에 접속하여 table을 생성해 준다."
        "wordCount": 3768
    }
</script>

</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="https://www.facebook.com/heungbae.lee" target="_blank" rel="noopener">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/HEUNG-BAE-LEE" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
    
        <a href="/2020/03/01/data_engineering_09/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">data engineering (데이터 파이프라인 자동화)</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/data-engineering/">data engineering</a></p>
                            <p class="item-title"><a href="/2020/03/03/data_engineering_10/" class="title">data engineering (데이터 모델링 및 챗봇 만들기)</a></p>
                            <p class="item-date"><time datetime="2020-03-03T14:29:20.000Z" itemprop="datePublished">2020-03-03</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/data-engineering/">data engineering</a></p>
                            <p class="item-title"><a href="/2020/03/01/data_engineering_09/" class="title">data engineering (데이터 파이프라인 자동화)</a></p>
                            <p class="item-date"><time datetime="2020-03-01T04:49:06.000Z" itemprop="datePublished">2020-03-01</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/data-engineering/">data engineering</a></p>
                            <p class="item-title"><a href="/2020/02/24/data_engineering_08/" class="title">data engineering (Presto란?)</a></p>
                            <p class="item-date"><time datetime="2020-02-24T13:11:09.000Z" itemprop="datePublished">2020-02-24</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/data-engineering/">data engineering</a></p>
                            <p class="item-title"><a href="/2020/02/22/data_engineering_07/" class="title">data engineering (데이터 웨어하우스 vs 데이터 레이크)</a></p>
                            <p class="item-date"><time datetime="2020-02-21T16:14:31.000Z" itemprop="datePublished">2020-02-22</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/data-engineering/">data engineering</a></p>
                            <p class="item-title"><a href="/2020/02/20/data_engineering_06/" class="title">data engineering (AWS DynamoDB 사용해서 오디오 feature 활용하기)</a></p>
                            <p class="item-date"><time datetime="2020-02-20T09:25:18.000Z" itemprop="datePublished">2020-02-20</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Bayes/">Bayes</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-C-자료구조/">C/C++/자료구조</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CS231n/">CS231n</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Front-end/">Front end</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kaggle/">Kaggle</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLP/">NLP</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Recommendation-System/">Recommendation System</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Statistics-Mathematical-Statistics/">Statistics - Mathematical Statistics</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/crawling/">crawling</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/data-engineering/">data engineering</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/deep-learning/">deep learning</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/growth-hacking/">growth hacking</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linear-algebra/">linear algebra</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/machine-learning/">machine learning</a><span class="category-list-count">5</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CS231n/">CS231n</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crawling/">crawling</a><span class="tag-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/CS231n/" style="font-size: 10px;">CS231n</a> <a href="/tags/crawling/" style="font-size: 20px;">crawling</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 사이드바 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4604833066889492"
     data-ad-slot="3275421833"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2020 HeungBae Lee</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'https://heung-bae-lee.github.io/2020/03/03/data_engineering_10/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>

</body>
</html>
